(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();function T(e){return e.nextElementSibling}function K(e,t){const o=T(e);let c=e.validationMessage;e.validity.patternMismatch&&(c=e.dataset.errorMessage),e.classList.add(t.inputErrorClass),o.textContent=c,o.classList.add(t.errorClass)}function U(e,t){const o=T(e);e.classList.remove(t.inputErrorClass),o.textContent="",o.classList.remove(t.errorClass)}function G(e,t){e.validity.valid?U(e,t):K(e,t)}function Q(e){return e.some(t=>!t.validity.valid)}function D(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function X(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}function M(e,t,o){Q(e)?D(t,o):X(t,o)}function Y(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.submitButtonSelector);M(o,c,t),o.forEach(n=>{n.addEventListener("input",()=>{G(n,t),M(o,c,t)})})}function L(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.submitButtonSelector);o.forEach(n=>{U(n,t)}),D(c,t)}function Z(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{Y(o,e)})}const ee=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),F=(e,t,{onPreviewPicture:o,onLikeIcon:c,onDeleteCard:n})=>{const r=ee(),a=r.querySelector(".card__like-button"),w=r.querySelector(".card__control-button_type_delete"),b=r.querySelector(".card__image"),R=r.querySelector(".card__like-count");return R.textContent=e.likes.length,b.src=e.link,b.alt=e.name,r.querySelector(".card__title").textContent=e.name,c&&a.addEventListener("click",()=>c(a,e._id)),e.likes.some(z=>z._id===t)&&a.classList.add("card__like-button_is-active"),e.owner._id!==t?w.remove():w.addEventListener("click",()=>n(r,e._id)),o&&b.addEventListener("click",()=>o({name:e.name,link:e.link})),r},$=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},f=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",$)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",$)},te=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})},s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"b412dad8-df99-4dfe-ae58-ba83f582ee07","Content-Type":"application/json"}},l=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),oe=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(l),O=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(l),re=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(l),ne=e=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(l),ce=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(l),se=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(l),ae=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(l),v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},N=document.querySelector(".places__list"),q=document.querySelector(".popup_type_edit"),y=q.querySelector(".popup__form"),W=y.querySelector(".popup__input_type_name"),j=y.querySelector(".popup__input_type_description"),C=document.querySelector(".popup_type_new-card"),p=C.querySelector(".popup__form"),le=p.querySelector(".popup__input_type_card-name"),ie=p.querySelector(".popup__input_type_url"),g=document.querySelector(".popup_type_image"),P=g.querySelector(".popup__image"),ue=g.querySelector(".popup__caption"),pe=document.querySelector(".profile__edit-button"),de=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),I=document.querySelector(".popup_type_edit-avatar"),_=I.querySelector(".popup__form"),me=_.querySelector(".popup__input"),h=document.querySelector(".popup_type_info"),_e=h.querySelector(".popup__title"),i=h.querySelector(".popup__info"),A=h.querySelector(".popup__list"),fe=h.querySelector(".popup__text"),ye=document.querySelector("#popup-info-definition-template").content,he=document.querySelector("#popup-info-user-preview-template").content,Se=document.querySelector(".logo"),B=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),m=(e,t)=>{const o=ye.cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},ve=e=>{const t=he.cloneNode(!0);return t.querySelector(".popup__list-item").textContent=e,t},d=(e,t,o,c)=>{e.textContent=t?o:c},be=()=>{i.innerHTML="",A.innerHTML="",O().then(e=>{_e.textContent="Статистика пользователей",i.append(m("Всего карточек:",e.length));const t=[...e].sort((r,a)=>new Date(a.createdAt)-new Date(r.createdAt));i.append(m("Первая создана:",B(new Date(t[t.length-1].createdAt)))),i.append(m("Последняя создана:",B(new Date(t[0].createdAt))));const o={};e.forEach(r=>{const a=r.owner._id;o[a]||(o[a]={name:r.owner.name,count:0}),o[a].count+=1});const c=Object.values(o);i.append(m("Всего пользователей:",c.length));const n=Math.max(...c.map(r=>r.count));i.append(m("Максимум карточек от одного:",n)),fe.textContent="Все пользователи:",c.forEach(r=>{A.append(ve(r.name))}),f(h)}).catch(e=>{console.log(e)})},H=({name:e,link:t})=>{P.src=t,P.alt=e,ue.textContent=e,f(g)},Le=e=>{e.preventDefault();const t=y.querySelector(".popup__button");d(t,!0,"Сохранение...","Сохранить"),re({name:W.value,about:j.value}).then(o=>{E.textContent=o.name,k.textContent=o.about,u(q)}).catch(o=>{console.log(o)}).finally(()=>{d(t,!1,"Сохранение...","Сохранить")})},qe=e=>{e.preventDefault();const t=_.querySelector(".popup__button");d(t,!0,"Сохранение...","Сохранить"),ne(me.value).then(o=>{x.style.backgroundImage=`url(${o.avatar})`,u(I)}).catch(o=>{console.log(o)}).finally(()=>{d(t,!1,"Сохранение...","Сохранить")})},Ce=e=>{e.preventDefault();const t=p.querySelector(".popup__button");d(t,!0,"Создание...","Создать"),ce({name:le.value,link:ie.value}).then(o=>{N.prepend(F(o,S,{onPreviewPicture:H,onLikeIcon:V,onDeleteCard:J})),u(C)}).catch(o=>{console.log(o)}).finally(()=>{d(t,!1,"Создание...","Создать")})},J=(e,t)=>{se(t).then(()=>{e.remove()}).catch(o=>{console.log(o)})},V=(e,t)=>{const o=e.classList.contains("card__like-button_is-active");ae(t,o).then(c=>{const n=e.closest(".card").querySelector(".card__like-count");n.textContent=c.likes.length,c.likes.some(r=>r._id===S)?e.classList.add("card__like-button_is-active"):e.classList.remove("card__like-button_is-active")}).catch(c=>{console.log(c)})};y.addEventListener("submit",Le);p.addEventListener("submit",Ce);_.addEventListener("submit",qe);Se.addEventListener("click",be);pe.addEventListener("click",()=>{W.value=E.textContent,j.value=k.textContent,L(y,v),f(q)});x.addEventListener("click",()=>{_.reset(),L(_,v),f(I)});de.addEventListener("click",()=>{p.reset(),L(p,v),f(C)});const ge=document.querySelectorAll(".popup");ge.forEach(e=>{te(e)});Z(v);let S;Promise.all([O(),oe()]).then(([e,t])=>{S=t._id,E.textContent=t.name,k.textContent=t.about,x.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{N.append(F(o,S,{onPreviewPicture:H,onLikeIcon:V,onDeleteCard:J}))})}).catch(e=>{console.log(e)});
